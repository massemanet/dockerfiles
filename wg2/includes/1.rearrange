#!/bin/bash
OUTSIDE="/tmp/.cache"
INSIDE="$HOME/.cache"
BAZEL="bazel/_bazel_$(id -nu)"
TMP="/tmp/$BAZEL"
OBI="$OUTSIDE/$BAZEL/install"

[ ! -d "$OUTSIDE" ] && exit 0
mkdir -p "$OUTSIDE/$BAZEL" || exit 1
mkdir -p "$(dirname "$TMP")" && mv "$INSIDE/$BAZEL" "$TMP"
ln -s "$OUTSIDE/$BAZEL" "$INSIDE/$BAZEL"
mkdir -p "$OBI"
for i in "$TMP/install/"*
do o="$OBI/$(basename "$i")"
   [ -e "$i" ] && [ ! -e "$o" ] && cp -r "$i" "$o"
done
